# TCP 简介

## TCP 一句话

* TCP 协议的作用就是：保证数据通信的完整性和可靠性，防止丢包

## TCP 数据包

* 以太网数据包(package)大小固定， 1500 字节是负载(payload), 22字节是头信息(head)
* IP 和 TCP 的头信息都至少需要 20 字节。
* TCP 实际负载约为 1400 字节

## TCP 数据包的编号

* 每个包都有当前编号 `sequence number (SEQ)` | 下个包编号 `next sequence number` | 两个相减是当前包的负载
* 第一个包的编号随机

## TCP 数据包的组装

* TCP 数据包组装由系统完成，然后发给监听该端口(`TCP 数据包里的`)的应用程序

## 慢启动和 ACK

* 在线路允许的情况下，达到最高效率
* TCP 利用`慢启动(slow start)`机制 | 开始时发送慢，然后根据丢包情况控制速度
* `ACK` (acknowledgement) 携带两个信息： 要收到的下一个数据包编号 | 接收方的接收窗口的剩余容量
* 发送方根据 ACK 的信息和自己已经发送的数据包的最新编号，从而控制发送速率，这称为`发送窗口`，大小可变

## 数据包的遗失处理

* 若下一个包没收到，则 ACK 中编号不会变 | 发送方收到 `三次` 连续重复的 ACK 或者 超时未收到 ACK ，则会重发 `编号对应的包`

## ACK 和 SEQ

* `SEQ` 自己发出的数据包的编号 | `ACK` 期待对方发出的下一个数据包的编号 | `length` 自己发出的数据包的负载长度
* 每当接收到 TCP 数据包 | 首先根据 SEQ 改变 ACK | 然后根据 ACK 发出自己的数据包和 length