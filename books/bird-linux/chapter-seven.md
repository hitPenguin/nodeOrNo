# 鸟哥的私房菜 | 第七章

## 文件系统的运行

* 文件系统被分别放在两个区块中:
  1. `inode`: 存放属性和权限
  2. `数据区块`: 实际数据
  3. 另外,有`超级区块`记录此文件系统的整体信息
```
  超级区块:
    记录例如: inode 与 数据区块的总量,使用量,剩余量,以及文件系统的格式与相关信息
  inode:
    记录文件的属性。一个文件占用一个 inode , 同时记录此文件的数据所在的区块号码。
  数据区块:
    实际记录文件的内容，若文件太大，会占用多个区块。
  因为文件占用的区块可能会分散，因此在读取时可能会变慢，因此需要磁盘碎片清理。
  例如:
    ext2:
      有 inode ，因此文件所在的多个区块可以同时读取
    FAT:
      无 inode , 要按顺序一个一个读取
```
* ext2 文件系统会格式化成多个 区块群组 | 每个区块群组的组成:
1. 数据区块: (1k, 2k, 4k)
```
  1. 原则上，区块的大小和数量在格式化完就不能再修改
  2. 每个区块最多只能放一个文件的数据
  3. 一个文件能占多个区块，单个文件填不满单个区块则浪费
```
2. inode table(inode 表)
```
  所记录的数据(部分):
    1. 文件的读写属性: r w x
    2. 文件的拥有者与用户组
    3. 文件大小
    4. 文件建立或状态改变的时间(ctime)
    5. 最近一次的读取时间(atime)
    6. 最近修改的时间(mtime)
    7. 定义文件的特性标识(flag)，如 SetUID
    8. 文件真正内容的指向(pointer)
  inode 的特点:
    1. 每个 inode 的大小固定，128B(ext4 和 xfs 可以设置到 256B)
    2. 每个文件占用一个 inode
    3. 系统读取文件时先找到 inode ， 并分析 inode 所记录的权限与用户是否符合，符合才读取区块的内容
    4. pointer 分为 12 个直接，1 个间接， 1 个双间接， 1 个三间接(记录一个区块需要 4B 大小)
                   12    +   256  +  256 * 256  + 256 * 256 * 256
```
3. Superblock(超级区块)
```
  记录的信息主要有:
    1. 数据区块和 inode 的总量
    2. 未使用和已使用的 inode 和 数据区块 的数量
    3. 数据区块 与 inode 的大小(block 为 1， 2， 4K，inode 为 128B 或 256B)
    4. 文件系统的挂载时间，最近一次写入数据的时间，最近一次检验磁盘的时间等文件系统的相关信息
    5. 一个有效位数值，若已被挂载，则有效位为 0，若未被挂载，则为 1
  备注: 超级区块在区块群组中可能有多个，但是基本均为备份。
  字段分为:
    1. 区块对照表(block bitmap)
    2. inode 对照表(inode bitmap)
```

## 目录 和 inode 的关系 | `ls -li`

```
  目录在底层的存储:
    1. inode 存储目录的相关权限和属性。
    2. 区块存储目录下的文件名和该文件名对应的 inode 号码。 (目录可对应多个区块)
```